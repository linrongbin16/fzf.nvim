# [`fzfx.helper`](https://github.com/linrongbin16/fzfx.nvim/tree/main/lua/fzfx/helper)

The `fzfx.helper` package contains all the line-oriented utilities for parsing and rendering the lines for (both left side and right side of) the fzf binary. Since a searching command is actually all about the lines: generating, previewing and invoking binded function on the lines.

And there're multiple sub-packages inside (sorted in alphabetical order):

- [`actions`](#fzfxhelperactions)
- [`parsers`](#fzfxhelperparsers)
- [`provider_decorators`](#fzfxhelperprovider_decorators)

## `fzfx.helper.actions`

This sub-package contains all the actions.

## `fzfx.helper.parsers`

This sub-package contains all the parsers used for parsing user inputs & query results. For example the `FzfxLiveGrep` runs `rg --column -n --no-heading --color=always -H -S 'fzfx'` command (suppose you have `rg` and search for text `'fzfx'`) as the underlying command, the query results look like:

<img width="860" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/033cd998-3b06-4846-8cff-d2794216ebc0">

It's easy to tell that the query results are lines, each line contains a single query result. In each line, there're 4 components separated by colons (`:`):

1. The file path that contains the keyword `'fzfx'`, starting from current working directory (`CWD`/`PWD`).
2. The line number specifies which line contains the keyword `'fzfx'`.
3. The column number specifies which column is the keyword `'fzfx'` starting.

   !> Note: The 3rd component **column number** only exists in `rg`, while `grep` and `git grep` don't have it.

4. The line text.

When previewing each line, this plugin will let the previewer know which line it's currently pointing to. In below example, inside `FzfxLiveGrep` command, the line `'minimal_init/packadd_init.lua:1:1:vim.o.numb...'` will be directly passed to the previewer's lua function as a function parameter.

<img width="989" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/38b507f7-fd5b-47c9-89b6-0db1aaa87e85">

Here comes our parsers to help parsing the line, and returns the 4 components we mentioned above.

In most cases, a searching command has only 1 format of query results, thus it only needs 1 parser. And when multiple searching commands use the same format as their query results, they can even use the same parser, thus reduce our develop/maintain effort.

### [`parse_find`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L27)

It parses query results generated by `fd`/`find` command, which looks like:

![files](https://github.com/linrongbin16/fzfx.nvim/assets/6496887/fa9649d4-4007-4e53-ad70-dcfb86612492)

It works for `FzfxFiles`, `FzfxBuffers`, `FzfxGFiles`.

### [`parse_rg`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L142) and [`parse_grep`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L61)

They parse query results generated by `rg`/`grep`/`git grep` command, which looks like:

![live_grep](https://github.com/linrongbin16/fzfx.nvim/assets/6496887/170ad807-a0f3-4092-9555-13ae67f38560)

They work for `FzfxLiveGrep` (use `parse_rg` if found `rg`, use `parse_grep` if not), and only `parse_grep` works for `FzfxGLiveGrep` since `git grep` will never have column number.

### [`parse_rg_no_filename`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L196) and [`parse_grep_no_filename`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L106)

It parses query results generated by `rg`/`grep` command, but without file name, i.e. the underlying command adds an extra `-I` option.

?> It's been used by `FzfxBufLiveGrep` command, which only do live grep on current buffer, and removes the file name to shorten the lines.

<img width="825" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/f2d4f3c7-15d0-44be-8d48-a4cf42541ffe">



## `fzfx.helper.provider_decorators`
