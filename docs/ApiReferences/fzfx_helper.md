# [`fzfx.helper`](https://github.com/linrongbin16/fzfx.nvim/tree/main/lua/fzfx/helper)

The `fzfx.helper` package contains all the line-oriented utilities for parsing and rendering the lines for (both left side and right side of) the fzf binary. Since a searching command is actually all about the lines: generating, previewing and invoking binded function on the lines.

And there're multiple sub-packages inside (sorted in alphabetical order):

- [`fzfx.helper.actions`](#actions)
- [`fzfx.helper.parsers`](#parsers)
- [`fzfx.helper.provider_decorators`](#provider_decorators)
- [`fzfx.helper.previewer_labels`](#previewer_labels)

## `actions`

This sub-package contains all the actions.

## `parsers`

This sub-package contains all the parsers used for parsing user inputs & query results. For example the `FzfxLiveGrep` runs `rg --column -n --no-heading --color=always -H -S 'fzfx'` command (suppose you have `rg` and search for text `'fzfx'`) as the underlying command, the query results look like:

<img width="70%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/033cd998-3b06-4846-8cff-d2794216ebc0">

It's easy to tell that the query results are lines, each line contains a single query result. In each line, there're 4 components separated by colons (`:`):

1. The file path that contains the keyword `'fzfx'`, starting from current working directory (`CWD`/`PWD`).
2. The line number specifies which line contains the keyword `'fzfx'`.
3. The column number specifies which column is the keyword `'fzfx'` starting.

   !> Note: The 3rd component **column number** only exists in `rg`, while `grep` and `git grep` don't have it.

4. The line text.

When previewing each line, this plugin will let the previewer know which line it's currently pointing to. In below example, inside `FzfxLiveGrep` command, the line `'minimal_init/packadd_init.lua:1:1:vim.o.numb...'` will be directly passed to the previewer's lua function as a function parameter.

<img width="70%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/38b507f7-fd5b-47c9-89b6-0db1aaa87e85">

Here comes our parsers to help parsing the line, and returns the 4 components we mentioned above.

In most cases, a searching command has only 1 format of query results, thus it only needs 1 parser. And when multiple searching commands use the same format as their query results, they can even use the same parser, thus reduce our develop/maintain effort.

### [`parse_find`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L27)

It parses query results generated by `fd`/`find` command, which looks like:

<img width="30%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/fa9649d4-4007-4e53-ad70-dcfb86612492">

It works for `FzfxFiles`, `FzfxBuffers`, `FzfxGFiles`.

### [`parse_rg`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L142) and [`parse_grep`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L61)

They parse query results generated by `rg`/`grep`/`git grep` command, which looks like:

<img width="60%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/170ad807-a0f3-4092-9555-13ae67f38560">

`parse_rg` works for `FzfxLiveGrep` when `rg` been found, `FzfxLspDiagnostics`, `FzfxLspDefinitions`, `FzfxLspImplementations`, etc. All LSP related commands query results are rendered in this format.

`parse_grep` works for `FzfxLiveGrep` when `rg` not found, `FzfxGLiveGrep`. The `git grep` command doesn't have column number.

### [`parse_rg_no_filename`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L196) and [`parse_grep_no_filename`](https://github.com/linrongbin16/fzfx.nvim/blob/fd516c2c7b75e3e6df8295775e1bee1ceb53253a/lua/fzfx/helper/parsers.lua?plain=1#L106)

It parses query results generated by `rg`/`grep` command, but without file name, i.e. the underlying command adds an extra `-I` option.

<img width="70%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/f2d4f3c7-15d0-44be-8d48-a4cf42541ffe">

It works for `FzfxBufLiveGrep` command, which only do live grep on current buffer, and removes the file name to shorten the lines.

### [`parse_git_status`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L241)

It parses query results generated by `git status --short` command, which looks like:

<img width="30%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/31946271-e0f3-406f-af93-2ec88108e189">

It works for `FzfxGStatus`.

### [`parse_git_branch`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L265)

It parses query results generated by `git branch` command.

For local branches, it looks like:

<img width="30%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/1619f4bc-eae5-4489-823b-43ede4890420">

For remote branches, it looks like:

<img width="45%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/440857b8-ad54-49bf-90bd-df68dde46f3d">

It works for `FzfxGBranches`.

### [`parse_git_commit`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L385)

It parses query results generated by `git log --date=short` command, which looks like:

<img width="60%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/1cac26af-c94c-4606-806e-759ec33ceb9f">

It works for `FzfxGCommits`.

### [`parse_lsd`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L495), [`parse_eza`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L494) and [`parse_ls`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L493)

`parse_lsd` parses query results generated by `lsd` command, `parse_eza` parses `eza`/`exa`, `parse_ls` parses `ls`. They look close to each other, the `eza` command result looks like:

<img width="50%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/5e402a20-6c96-43a1-a463-345cd2bd86c7">

When `lsd` found, `parse_lsd` works for `FzfxFileExplorer`. When `eza`/`exa` found, `parse_eza` works. When all of them not found, `parse_ls` works.

### [`parse_vim_command`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L511)

It parses the query results generated by Neovim `:command` command.

?> Note: We direct the output of Neovim `:command` command into a temporary file, then render the file contents into lines, so the query results are not the output of a shell command.

The rendered lines look like:

<img width="60%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/5abe8ccd-e98f-4e15-b827-82d93491d0c0">

It works for `FzfxCommands`.

### [`parse_vim_keymap`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L570)

It parses the query results generated by Neovim `:verbose map` command (it's not the output of a shell command as well), which looks like:

<img width="60%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/970bb0dd-e010-4f52-b972-970cf888be75">

It works for `FzfxKeyMaps`.

### [`parse_vim_mark`](https://github.com/linrongbin16/fzfx.nvim/blob/65f355c99b2763c71d3ac63cd40fdee560b33c3c/lua/fzfx/helper/parsers.lua?plain=1#L642)

It parses the query results generated by Neovim `:marks` command (it's not the output of a shell command as well), which looks like:

<img width="60%" alt="image" src="https://github.com/linrongbin16/fzfx.nvim/assets/6496887/72d278fa-51ba-403a-b976-28449d99be5f">

It works for `FzfxMarks`.

## `provider_decorators`

## `previewer_labels`
