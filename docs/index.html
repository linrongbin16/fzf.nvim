<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css"
    />
  </head>
  <body>
    <div id="app"></div>
    <script>
      window.$docsify = {
        name: "fzfx.nvim",
        repo: "linrongbin16/fzfx.nvim",
        maxLevel: 8,
        subMaxLevel: 8,
        search: "auto",
        homepage: "REFERENCES.md",

        plugins: [
          function (hook, vm) {
            hook.beforeEach(function (html) {
              const tasks = [];

              // =permanent-link
              var regex = /=permanent-link\((.*)\)/g;
              html = html.replace(regex, function (match, content) {
                // Get the permanent-link
                const api = content;
                // Get which lines you want
                const tokens = content.split("#");
                const lines = tokens[1].replaceAll("L", "").split("-");
                const from_line = lines[0];
                const to_line = lines[1];

                // https://raw.githubusercontent.com/linrongbin16/commons.nvim/4fb28b74e15792397379ea9469b825d19fa9b946/lua/commons/apis.lua
                // const raw = tokens[0].replaceAll(
                //   "https://github.com/linrongbin16/commons.nvim/blob",
                //   "https://raw.githubusercontent.com/linrongbin16/commons.nvim",
                // );

                // fetch content
                const task = fetch(api)
                  .then((resp) => {
                    console.log("resp:");
                    console.log(resp);
                    return resp.json();
                  })
                  .then((data) => {
                    console.log("data:");
                    console.log(data);
                    // html = html.replace(match, data);
                  })
                  .catch((err) => {
                    console.log("err:");
                    console.log(err);
                  });

                tasks.push(task);
              });

              // all tasks done and return
              Promise.all(tasks).then((finish) => {
                if (/githubusercontent\.com/.test(vm.route.file)) {
                  url = vm.route.file
                    .replace("raw.githubusercontent.com", "github.com")
                    .replace(/\/main/, "/blob/main");
                } else {
                  url =
                    "https://github.com/linrongbin16/fzfx.nvim/blob/main/docs/" +
                    vm.route.file;
                }
                const editHtml = "[:memo: Edit Document](" + url + ")\n";
                const powerByHtml =
                  "\n\n----\n\n" +
                  '<a href="https://docsify.js.org" target="_blank" style="color: inherit; font-weight: normal; text-decoration: none;">Powered by <span style="color:#42b983">docsify</span>.</a>';

                next(editHtml + html + powerByHtml);
              });
            });
          },
        ],
      };
    </script>
    <!-- Docsify v4 -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-lua.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-yaml.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  </body>
</html>
